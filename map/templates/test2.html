<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
    <script>
        var pos;
        let markers = [];
        var r, p;
        var info = null;
        var map;
        var cate;
        var directionsDisplay;
        var directionsService;
        var mode, highways;
        var timeId;
        var input;
        var searchBox;
        var reSearchFlag = true;
        var word = '';
        var week;
        var hours;
        var dayFlag;
        var timeFlag;
        var enterFlag;
        var nullnull = 1;
        var dayNum;
        var timeNum;
        var year;
        var month;
        var nowDay;
        var weeks = { '月曜日': 0, '火曜日': 1, '水曜日': 2, '木曜日': 3, '金曜日': 4, '土曜日': 5, '日曜日': 6 };
        // dayWeek( 2022, 2, 8);

        // function dayWeek(year, month, nowDay) {
        //     if (year == null) {
        //         var date = new Date();
        //         year = date.getFullYear();
        //     }
        //     if (month == null) {
        //         var date = new Date();
        //         month = date.getMonth() + 1;
        //     }
        //     if (nowDay == null) {
        //         var date = new Date();
        //         nowDay = date.getDate();
        //     }

        //     // Dateオブジェクトには実際の月ー１の値を指定するため
        //     // var jsMonth = month - 1;
        //     // Dateオブジェクトは曜日情報を0から6の数値で保持しているため、翻訳する
        //     var dayOfWeekStrJP = [6, 0, 1, 2, 3, 4, 5];
        //     // 指定日付で初期化したDateオブジェクトのインスタンスを生成する
        //     var date = new Date(year, month, nowDay);
        //     // 木曜日は数値の4として保持されているため、dayOfWeekStrJP[4]の値が出力される
        //     console.log(year);
        //     console.log(month);
        //     console.log(nowDay);
        //     console.log(dayOfWeekStrJP[date.getDay()]);
        // }

        // $.ajax({
        //     url: '/route_transit?start=00008247&goal=00005172&via=[{"node":"00006668"}]&start_time=2019-10-01T08:00:00&options=railway_calling_at',
        //     type: 'GET',
        //     dataType: 'jsonp',
        //     jsonpCallback: 'callback'
        // }).done(function (data) {
        //     console.log(data);
        // }).fail(function (data) {
        //     console.log("no"); // 失敗時
        // });


        test3('病院　18時　10日');



        var monthFlag = 0;
        function test3(data) {
            dayNum;
            timeNum;
            dayFlag = null;
            timeFlag = null;
            word = '';
            var year = null;
            var month = null;
            week;
            hours;
            nullnull = 1;
            monthFlag = 0;
            data = data.split(/[,、\　\ ]/);
            console.log(data.length);
            var strDayFlag = 0;
            for (let i = 0; i < data.length; i++) {
                const day = data[i].match(/.曜日/);

                var strDay = replaceFullToHalf(data[i]);
                if (strDay.match(/[0-9]+日/) != null) {
                    strDayFlag = 1;
                    strDay = strDay.replace(/['日']/, '');
                    var dey = new Date();
                    dey = dey.getDate();
                    console.log(dey);
                    console.log(strDay);

                    if (dey > strDay) {
                        monthFlag = 1;
                    }
                    console.log(strDay);
                    strDay = Number(strDay);
                    data[i] = '';
                }

                var time = replaceFullToHalf(data[i]);
                // var time = data[i].match(/([0-9]+時[0-9]+分$|[0-9]+時半$|[0-9]+時$)/);
                time = time.match(/([0-9]+[0-9時]+分$|[0-9]+時半$|[0-9]+時$)/);

                if (day != null) {
                    dayNum = i;
                }
                if (time != null) {
                    timeNum = i;
                }
            }

            console.log(dayNum + ' ' + timeNum);
            if (dayNum == null && timeNum == null) {
                nullnull = 0;
                console.log(nullnull);
            }
            for (let i = 0; i < data.length; i++) {
                if (i != dayNum && i != timeNum) {
                    word += ' ' + data[i];
                    console.log(word);
                }
            }
            // if (typeof dayNum === "undefined") {
            if (strDayFlag == 1) {
                dayWeek(year, month, strDay);
            } else {
                // if (dayNum == null) {
                if (week == null) {
                    dayFlag = 1;
                    var now = new Date();
                    var nowWeek = now.getDay();
                    var nowWeeks = ['日曜日', '月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日'];
                    week = weeks[nowWeeks[nowWeek]];
                    console.log('newWeek   ' + week);
                } else {
                    // } else {
                    week = weeks[data[dayNum]];
                    console.log(week);
                    // }
                }
            }
            console.log('曜日　　' + week);
            console.log(week + " " + timeNum + ' ' + word);
            // if (typeof timeNum === "undefined") {
            if (timeNum) {
                console.log(data[timeNum]);
                hours = replaceFullToHalf(data[timeNum]);
                hours = hours.replace(/[半]/, '30分');
                hours = hours.replace(/['時']/, '');
                if (hours.indexOf('分') === -1 && hours.indexOf('半') === -1) {
                    hours = Number(hours);
                    hours = hours * 100;
                } else {
                    hours = hours.replace(/['分']/, '');
                }
                hours = Number(hours);
                console.log(hours);
            } else {
                if (time == null) {
                    timeFlag = 1;
                    var now = new Date();
                    var Hour = now.getHours();
                    var Min = now.getMinutes();
                    var nowTime = Hour * 100 + Min;
                    hours = nowTime;
                    console.log('new Hours   ' + hours);
                }
            }
            // console.log(week);
            // console.log(hours);
            if (week != null || hours != null) {
                if (timeFlag !== 1 && dayFlag !== 1) {
                    // reSearchFlag = 1;
                    // reSearch(word);
                }
                console.log(week + " " + hours + ' ' + word);
                console.log('enterEnd');
            }
        }

        function dayWeek(year, month, nowDay) {
            if (year == null) {
                var date = new Date();
                year = date.getFullYear();
            }
            if (month == null) {
                var date = new Date();
                var monthNum = 1;
                if (monthFlag == 1) {
                    monthNum = monthNum + 1;
                }
                month = date.getMonth() + monthNum;
            }
            if (nowDay == null) {
                var date = new Date();
                nowDay = date.getDate();
            }

            // Dateオブジェクトには実際の月ー１の値を指定するため
            // var jsMonth = month - 1;
            // Dateオブジェクトは曜日情報を0から6の数値で保持しているため、翻訳する
            var dayOfWeekStrJP = [6, 0, 1, 2, 3, 4, 5];
            // 指定日付で初期化したDateオブジェクトのインスタンスを生成する
            var date = new Date(year, month, nowDay);
            // 木曜日は数値の4として保持されているため、dayOfWeekStrJP[4]の値が出力される
            console.log(year);
            console.log(month);
            console.log(nowDay);
            console.log(dayOfWeekStrJP[date.getDay()]);
            week = dayOfWeekStrJP[date.getDay()];
        }


        // 全角→半角(英数字)
        function replaceFullToHalf(str) {
            return str.replace(/[！-～]/g, function (s) {
                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
            });
        }
    </script>
</body>

</html>