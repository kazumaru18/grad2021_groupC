{% extends 'base.html' %}
{% block title %}予定表{% endblock%}
{% load static %}

{% block contents%}

<link href="{% static 'css/calendar.css' %}" rel="stylesheet" />
<style>
* {
    margin: 0;
    padding: 0;
}
body {
    height: 100vh;
    width: 100%;
}
.custom-view table{
  width: 100%;
}
.custom-view thead th {
  padding: 10px;
  text-align: left;
}
.custom-view tbody th,
.custom-view tbody td {
  padding: 10px;
  text-align: left;
}
.no-data {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  padding: 80px;
  background: #d0d0d04d;
  border: 1px solid #ddd;
}
#calendar{
  margin-top: 30px;
  background-color: #ffff;
}
.cal_block{
  margin-top: 30px;
}
.cal_title{
  background: #696969; /*背景色*/
  padding: 10px;/*文字周りの余白*/
  color: white;/*文字を白に*/
  border-radius: 0.5em;/*角の丸み*/
  width: 25%;
  margin: 0 auto;
  text-align: center;
}
@media screen and (max-width:768px) {
  body {
    font-size: 62.5%;
  }
  .cal_title{
  width: 100%;
}
}

</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'js/calendar.js' %}"></script>
<script>
  (function(){
    $(function(){
      // calendarエレメント取得
      var calendarEl = $('#calendar')[0];

      var events = JSON.parse(localStorage.getItem('events'));
      // full-calendar生成する。
      var calendar = new FullCalendar.Calendar(calendarEl, {
        height: 'auto', // calendarの高さ設定
        expandRows: true, // 画面に合わせて高さを再設定
        slotMinTime: '08:00', // Dayカレンダーに開始時間
        slotMaxTime: '20:00', // Dayカレンダーに終了時間
        // ヘッダーに表示するツールバー
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
        },
        initialView: 'dayGridMonth', // 初期ロードする時、見えるカレンダーの画面(基本設定:月)	
        navLinks: true, // 日付を選択するとDayカレンダーやWeekカレンダーにリンク
        businessHours: true,　// 休日表記
        editable: true, // 修正可能
        selectable: true, // カレンダーのドラッグ設定可能	
        nowIndicator: true, // 現在時間マーク
        dayMaxEvents: true, // イベントの数がオバーすると高さの制限(+のマークと何個式で表現)
        locale: 'ja', // 日本語設定  
        dayCellContent: function(e) {
        e.dayNumberText = e.dayNumberText.replace('日', '');
        }, //　カレンダーの'日'を削除

        //console ni hyouji 
        eventAdd: function(obj) { // イベントが追加すると発生するイベント
          console.log(obj);
        },
        eventChange: function(obj) { // イベントが修正されたら発生するイベント
          console.log(obj);
        },
        eventRemove: function(obj){ // イベントが削除すると発生するイベント
          console.log(obj);	
        },

        select: function(arg) { // カレンダーでドラックでイベントを生成することが可能。
          var title = prompt('予定を入力してください:');//popup表示にしたい
          if (title) {//カレンダー表示(localstorageのデータは表示できない)
            calendar.addEvent({
              title: title,
              start: arg.start,
              end: arg.end,
              allDay: arg.allDay
              })

              var calendar_events;
              
              calendar_events = [{//配列でlocalstorageに保存
                title: title,
                start: arg.start,
                end: arg.end,
            }];

            calendar_events.push(calendar_events);
            localStorage.setItem('events', JSON.stringify(calendar_events ));

          calendar.unselect()
        }
        },

      });
      // カレンダーレンダリング
      calendar.render();
    });
  })();	
</script>
<div class="cal_block">
  <h1 class="cal_title">予定表</h1>
  <div id='calendar'></div>
</div>
<div class="bg_pattern Paper_v2"></div>
  {% endblock %}
