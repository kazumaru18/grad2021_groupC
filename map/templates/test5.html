<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width">
<meta name="robots" content="all" />
<meta name="author" content="toogie">
<meta name="description" content="このページはブログ『Wataame Frog』の「Google Map APIのサンプルを色々と6種類作ってみた」という記事のサンプルです">
<meta name="keywords" content="">
<title>サンプル6：任意の２点間のルート検索</title>
<link rel="stylesheet" href="../js/css/layout.css">
<link rel="stylesheet" href="../js/css/base.css">
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBWoRgUSbwgWs83NjxXDl8ax629mzI5yXg&sensor=false"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>
var map, begin, end;
var directionsDisplay;
var directionsService;

begin = '東京駅';
end = '東京スカイツリー';

$(function() {
    $('#searchButton').click(function(e) {
        e.preventDefault();         // hrefが無効になり、画面遷移が行わない

        begin = $('#inputBegin').val();
        end   = $('#inputEnd').val();

        // ルート説明をクリア
        $('#directionsPanel').text(' ');

        google.maps.event.addDomListener(window, 'load', initialize(begin, end));
        google.maps.event.addDomListener(window, 'load', calcRoute(begin, end));
    });
});


function initialize(begin, end) {
    // インスタンス[geocoder]作成
    var geocoder = new google.maps.Geocoder();

    geocoder.geocode({
        // 起点のキーワード
        'address': begin

    }, function(result, status) {
        if (status == google.maps.GeocoderStatus.OK) {
            // 中心点を指定
            var latlng = result[0].geometry.location;

            // オプション
            var myOptions = {
                zoom: 14,
                center: latlng,
                scrollwheel: false,     // ホイールでの拡大・縮小
                mapTypeId: google.maps.MapTypeId.ROADMAP,
            };

            // #map_canvasを取得し、[mapOptions]の内容の、地図のインスタンス([map])を作成する
            map = new google.maps.Map(document.getElementById('map_canvas'), myOptions);

            // 経路を取得
            directionsDisplay = new google.maps.DirectionsRenderer();
            directionsDisplay.setMap(map);
            directionsDisplay.setPanel(document.getElementById('directionsPanel'));     // 経路詳細

            // 場所
            $('#begin').text(begin);
            $('#end').text(end);

        } else {
            alert('取得できませんでした…');
        }
    });
}

// ルート取得
function calcRoute(begin, end) {

    var request = {
        origin: begin,         // 開始地点
        destination: end,      // 終了地点
        travelMode: google.maps.TravelMode.DRIVING,     // [自動車]でのルート
        avoidHighways: true,        // 高速道路利用フラグ
    };

    // インスタンス作成
    directionsService = new google.maps.DirectionsService();

    directionsService.route(request, function(response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
            directionsDisplay.setDirections(response);
        } else {
            alert('ルートが見つかりませんでした…');
        }
    });
}

// キック
google.maps.event.addDomListener(window, 'load', function() {
    initialize(begin, end);
    calcRoute(begin, end);
});
</script>

<style>
#map_canvas {
    margin: 0;
    padding: 0;
    margin-bottom: 1em;
    height: 550px;
}

#inputBegin, #inputEnd{
    width: 200px;
}
</style>
</head>
<body>
<header><span>Wataame Frog</span></header>

<div class="parentBox1Column">

    <div class="child1">

                <div class="adsenseBn">
            <!-- (2015.05.13) blog_sample_responsive -->
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <!-- blog_sample_responsive -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-8400362668779474"
                 data-ad-slot="4834112033"
                 data-ad-format="rectangle"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>


        <h1 id="start">Google Map Apiテスト</h1>

        <p class="descriptionMemo">
            このページはブログ『Wataame Frog』の「<strong>Google Map APIのサンプルを色々と6種類作ってみた</strong>」という記事のサンプルです。<br />
            記事URL : <a href="https://nodoame.net/archives/6905" target="_blank">https://nodoame.net/archives/6905</a>
        </p>

        <h2>サンプル6：任意の２点間のルート検索</h2>

        <div class="searchbox">
            <form method="post" action="./index6.html">
            <p><span class="bold">住所･地名から検索</span></p>
            Begin:<input type="text" name="sp" id="inputBegin">
            End:<input type="text" name="ep" id="inputEnd">
            <input type="submit" name="regist" value="検索" id="searchButton">
            <a href="./index6.html">初期化</a>
            </form>
        </div>

        <h3><span id="begin"></span> → <span id="end"></span></h3>

        <div id="map_canvas"></div>

        <div id="directionsPanel"></div>


        <div class="sampleLinks1column">
            <p>関連スクリプト</p>
            <ul>
                <li><a href="./">サンプル1</a></li>
                <li><a href="./index2.html">サンプル2</a></li>
                <li><a href="./index3.html">サンプル3</a></li>
                <li><a href="./index4.html">サンプル4</a></li>
                <li><a href="./index5.html">サンプル5</a></li>
                <li><a href="./index6.html">サンプル6</a></li>
            </ul>
        </div>


    </div><!--//.child1-->

</div><!--//.parentBox1Column-->


<footer>
<script type="text/javascript">
now = new Date();
nowyear = now.getFullYear();
document.write("Copyright &copy; 2011-" + nowyear);
</script>
<a href="https://nodoame.net" targtet="_blank">Wataame Frog</a> . All Rights Reserved.
</footer>


</body>
</html>